\documentclass[12pt,notitlepage]{report}
\usepackage{indentfirst}
\usepackage[pdftex]{graphicx}
\usepackage{subfig}
\usepackage{amsmath}

\title{Two-component BEC dynamics calculations using split-step Fourier method}
\author{Bogdan Opanchuk}

\begin{document}
\maketitle

\section*{Natural units}

Before we start doing any calculations, a transformation to dimensionless units should be defined. It will significantly increase readability of equations and facilitate various estimations.

There are several ways to do it; since we are working with the harmonic potential, the obvious variant is to use the parameters of harmonic oscillator as new units, taking into account the usual symmetry $\omega_x = \omega_y = \omega_\rho$ which exists in experiments:
\[ l_\rho =  \sqrt{\frac{\hbar}{m\omega_\rho}},\, t_\rho = \frac{1}{\omega_\rho},\, E_\rho = \hbar \omega_\rho. \]

Dimensionless variables will be mainly used throughout the article, so, for the sake of readability, they will be explicitly marked with primes only when they can be confused with variables in real units. In other places all variables should be considered dimensionless unless explicitly specified as real. For example, the transformation of coordinates will look like:
\[ x = x^\prime l_\rho,\, y = y^\prime l_\rho,\, z = z^\prime l_\rho. \]

Wave function can be transformed in different ways depending on the normalisation. We will use the transformation that keeps the integral of wave function over space equal to number of particles in the system:
\[ \Psi = \Psi^\prime l_\rho^\frac{3}{2}. \]

\section*{Thomas-Fermi approximation}

We are looking for steady state of the system with pseudopotential model hamiltonian (in real units):
\[ 
\hat{H} = -\frac{\hbar^2}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} + \\
V(\mathbf{r}) + g_{11} \vert \Psi(\mathbf{r}) \vert^2,
\]
\[ g_{11} = \frac{4 \pi \hbar^2 a_{11}}{m}, \]
\[ V(\mathbf{r}) = \frac{m}{2} \left( \omega_x^2 x^2 + \omega_y^2 y^2 + \omega_z^2 z^2 \right). \]
where $V(\mathbf{r})$ is the potential energy for parabolic trap, $g_{11}$ is the interaction coefficient and $a_{11}$ is the scattering length for atoms in non-excited state. In natural units:
\[
\hat{H} = -\frac{1}{2} \frac{\partial^2}{\partial \mathbf{r}^2} + 
\frac{1}{2} \left( x^2 + y^2 + \lambda^{-2} z^2 \right) + g_{11} \vert \Psi(\mathbf{r}) \vert^2,
\]
where
\[ \lambda = \frac{\omega_\rho}{\omega_z},\, g_{11} = \frac{4 \pi a_{11}}{l_\rho}. \]

The steady state should satisfy the Gross-Pitaevskii equation:
\[ \hat{H} \Psi = \mu \Psi. \]
To get the first approximation of the state function, we consider the kinetic term to be small as compared to other terms and omit it. The conditions for this operation to be valid will be determined later in this section. Thus we get the simple equation:
\[ \left( V(\mathbf{r}) + g_{11} \vert \Psi(\mathbf{r}) \vert^2 \right) \Psi(\mathbf{r}) = \mu \Psi(\mathbf{r}), \]
which leads us to the state function:
\[ \vert \Psi(\mathbf{r}) \vert^2 = \frac{1}{g_{11}} \max \left( \mu - V(\mathbf{r}), 0 \right). \]
The condition for $V(\mathbf{r})$ defines the shape of the condensate - it is the ellipsoid with the following radii:
\[ r_x = r_y = \sqrt{2\mu},\, r_z = \lambda \sqrt{2\mu}. \]

Using the normalisation condition for the steady state function gives us the connection between the number of atoms in the condensate and the chemical potential:
\[ \int\limits_{V} \vert \Psi(\mathbf{r}) \vert^2 dV = N, \]
\[ \mu = \left( \frac{15 N g_{11}}{16 \lambda \sqrt{2}} \right)^{\frac{2}{5}}, \]
or, in real units:
\[ 
\mu = \left( \frac{15 N}{8 \pi} \right)^\frac{2}{5} 
\left( \frac{m \bar{\omega}^2}{2} \right)^\frac{3}{5}
{g_{11}}^\frac{2}{5},
\]
where $\bar{\omega} = \sqrt[3]{\omega_x \omega_y \omega_z}$.

Now we can roughly estimate the conditions necessary to drop the kinetic term from equation. Substitution of the approximate solution and calculation of the second derivative gives us the following inequation:
\[
\left( 
	\frac{2 + \lambda^{-2}}{2 \sqrt{\mu - V(\mathbf{r})}} +
	\frac{\left( x + y + \lambda^{-2}z \right)^2}{4 \left( \mu - V(\mathbf{r}) \right)^{\frac{3}{2}}} 
\right) \ll
\mu \sqrt{\mu - V(\mathbf{r})}.
\]
In the experiments $\lambda$ is usually of the order of ten, so we can drop terms with $\lambda^{-2}$. Therefore, near the centre of the condensate we this inequation simplifies to $\mu \gg 1$, which, in turn gives us the condition:
\[ \frac{N a_{11}}{\lambda l_\rho} \gg 1. \]

On the other hand, near the edges the left-hand side of the inequation converges to infinity, while the right-hand side equals zero. This means that near the edges of the condensate Thomas-Fermi approximation fails regardless of the conditions. Fortunately, the density of the particles there is low, so we can estimate the width $h$ of the "belt" where our first approximation of the state function is significantly incorrect. If it happens to be small as compared to the size of the condensate, the approximation can be considered valid.

The first term at the left-hand side of the inequation converges to infinity slower than the second one and can be dropped. Then, for the sake of simplicity, we consider two of three coordinates to be zero and the third one to equal $r - h$, where $r$ is the corresponding radius of the condensate. After replacing "$\ll$" by "$\approx$" and assuming $h$ to be small as compared to $r$, we obtain:
\[ h_x \approx \frac{2}{\sqrt{2 \mu}},\, h_z \approx \frac{2}{\lambda \sqrt{2 \mu}}. \]
They have to be much smaller than corresponding radii, which gives us:
\[ x:\: \mu \gg 1,\, z:\: \mu \gg \lambda^{-2}. \]
The former condition is the same as for the centre of the condensate, but the latter one is much less strict. Therefore, we have only one condition justifying the application of Thomas-Fermi approximation: $\mu \gg 1$.
 
Let us use some real-life experimental parameters and check how well Thomas-Fermi approximation works. For three-dimensional trap with frequencies $f_x = f_y = 97.6 \textrm{ Hz}$ and $f_x = 11.96 \textrm{ Hz}$ and $10^5$ rubidium atoms (which have scattering length $a_{11} = 100.4 a_0$, where $a_0$ is Bohr radius) we have $\mu \approx 7.56$. This means that Thomas-Fermi approximation produces solution which is close to the real one. But for lower amount of atoms, say $10^4$, we get $\mu \approx 3.02$, which is a sign that the we have reached the limit of the approximation's applicability. Therefore, for low amounts of atoms, Thomas-Fermi approximation must be used with care.

\section*{Steady state calculation}

The steady state obtained using Thomas-Fermi approximation is good for estimation purposes, but not for real-life calculations - for example, it does not have continuous first derivative everywhere (namely, near the edges of the condensate). That is why we have to employ numerical calculations in order to find precise (to a certain extent) solution of the Gross-Pitevskii equation. One of the possible ways, the propagation in imaginary time using split-step Fourier method, will be described in this section.

The idea of the propagation in imaginary time is that propagating the system state using the time-dependent GPE but with substitution $t \rightarrow \tau = it$ diminishes energy of the system, so after the sufficient amount of time this propagation will lead us to steady state. The rigorous proof of this method can be found in \cite{gpe_ngf}, but there is a simple "hand-waving" explanation. It assumes the superposition principle works for GPE, though it does not because of the nonlinearity.

Let us say we have the system with Hamiltonian $\hat{H}$, whose eigenvalues are $\mu_1 < \mu_2 < ...$. They do not have to correspond to real states of BEC, we just know that this Hamiltonian must have discrete spectre (because of the form of the potential) and the lowest eigenvalue corresponds to steady state we want to find. The steady solution of time-dependent GPE
\[ i \frac{\partial \Psi}{\partial t} = \hat{H} \Psi \]
then looks like
\[ \Psi(\mathbf{r}, t) = \sum_k e^{-i \mu_k t} f_k(\mathbf{r}). \]
We can use Hamiltonian to propagate the solution in time:
\[ 
\Psi(t + dt) \simeq \Psi(t) + \frac{\partial \Psi}{\partial t} dt =
\Psi(t) + \frac{dt}{i} \hat{H} \Psi(t).
\]

Now consider the substitution $t \rightarrow \tau = it$; after it the steady solution will become fading, with higher-energy components fading faster:
\begin{equation}
\label{split_step_steady_state:general_solution_imaginary_time}
\Psi(\mathbf{r}, \tau) = \sum_k e^{-\mu_k \tau} f_k(\mathbf{r}).
\end{equation}
Therefore, if we take some random initial solution and propagate it for a sufficient amount of time, higher-energy components will eventually die out (in comparison with the lowest-energy state) and leave us with desired steady state:
\begin{equation}
\label{split_step_steady_state:iterative_process}
\Psi(\tau + d\tau) \simeq \Psi(\tau) - d\tau \hat{H} \Psi(\tau).
\end{equation}
The state obtained from Thomas-Fermi approximated GPE can be taken as an initial one, since it is rather close to the desired one (and, therefore, higher-energy components are already quite small).

Since the energy will decrease exponentially after each step and the precision of numerical calculations is limited, renormalisation after each step will be required. Known total number of atoms in steady state serves best in this case (because we will have to renormalise the final steady state anyway):
\[ \int\limits_V \vert \psi(\tau, \mathbf{r}) \vert^2 dV = N. \]

Propagation should be terminated when the total energy of the state stops changing (that is, only one component with the lowest energy is left out). So, we need to calculate the total energy after each step:
\[ E(\psi) = \int\limits_V \psi^\dagger \left(
-\frac{\hbar^2}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} + V(\mathbf{r}) +
\frac{g_{11}}{2} \vert \psi(\mathbf{r}) \vert^2 \right) \psi dV \]
and compare it to the previous value.

Now how do we propagate the state of the system? There are a lot of possibilities, one of which is split-step Fourier method. It is rather simple and can be effectively parallelised, which means a good scaling and low computation times. 

The propagation in imaginary time can be described as:
\[ \Psi(\tau + d\tau, \mathbf{r}) \simeq \exp ( -d\tau \hat{H} ) \Psi(\tau, \mathbf{r}). \]
The idea of split-step Fourier method is to separate the execution of different parts of Hamiltonian:
\begin{equation}
\label{split_step_steady_state:splitted_propagation}
\psi(\tau + d\tau, \mathbf{r}) \simeq \exp(d\tau \hat{D}) \exp(d\tau \hat{N}) \psi(\tau, \mathbf{r}),
\end{equation}
where $\hat{D}$ and $\hat{N}$ are chosen so that they could be executed most conveniently in Fourier and spatial domains correspondingly. For our Hamiltonian
\[ 
\hat{H} = -\frac{1}{2} \frac{\partial^2}{\partial \mathbf{r}^2} +
V(\mathbf{r}) + g_{11} \vert \Psi(\mathbf{r}) \vert^2,
\]
it means that
\[
\hat{D} = \frac{1}{2} \frac{\partial^2}{\partial \mathbf{r}^2},\,
\hat{N} = -\left( V(\mathbf{r}) + g_{11} \vert \Psi(\mathbf{r}) \vert^2 \right).
\]
The spatial derivative is a simple multiplication in Fourier domain, so the propagation can be performed straightforwardly:
\[
\Psi(\tau + d\tau, \mathbf{r}) \simeq \left\{ \hat{F}^{-1} \exp \left[ d\tau \hat{D}(i\omega) \right] \hat{F} \right\}
\exp(d\tau \hat{N}) \Psi(\tau, \mathbf{r}).
\]
Here $\hat{D}(i\omega)$ is obtained by replacing differential operator by $i \omega$, where $\omega$ is a frequency in Fourier domain.

In order to improve the accuracy of the method, equation \ref{split_step_steady_state:splitted_propagation} can be rewritten as
\[
\Psi(\tau + d\tau, \mathbf{r}) \simeq \exp \left( \frac{d\tau}{2} \hat{D} \right)
\exp \left( \int\limits^{\tau + d\tau}_\tau \hat{N} (\tau^\prime) d\tau^\prime \right)
\exp \left( \frac{d\tau}{2} \hat{D} \right) \Psi(\tau, \mathbf{r}).
\]
This method is called the symmetrized split-step Fourier method. Integral can be evaluated either by approximating it with $d\tau\hat{N}$ or by using more accurate method, like trapezoidal rule
\[
\int\limits^{\tau + d\tau}_\tau \hat{N} (\tau^\prime) d\tau^\prime \simeq
\frac{d\tau}{2} \left( \hat{N}(\tau) + \hat{N}(\tau + d\tau) \right).
\]
Since the value of $\hat{N}(\tau + d\tau)$ is unknown at the time of the calculation (it is performed in the middle of the step), an iterative procedure is necessary.

\section*{Split-step propagation}

Now when we have got the steady state for one-component system, it is the time to start the simulation of two-component system. The initial state for the component $\vert1\rangle$ is the one-component steady state, and for $\vert2\rangle$ the initial state equals to zero.

In the experiment, system evolution starts with the $\frac{\pi}{2}$ pulse, which transforms relative density to relative phase:
\[
\begin{pmatrix}
	\psi^\prime_1 \\
	\psi^\prime_2
\end{pmatrix} = \\
\begin{pmatrix}
	1 & -i \\
	-i & 1
\end{pmatrix} \\
\begin{pmatrix}
	\psi_1 \\
	\psi_2
\end{pmatrix}.
\]
Of course, the pulse is not instantaneous, but as a first approximation it can be treated like one. The evolution of the system is described by coupled Gross-Pitaevskii equations. They can contain different terms depending on which features of the system we need to take into account. Basic form can be found in many sources, i.e. \cite{pitaevskii_bec}; with the addition of loss terms it looks like:
\[ i \hbar \frac{\partial \psi_1}{\partial t} = \left(
	-\frac{\hbar^2\nabla^2}{2m} + V_1(\mathbf{r}) + 
	g_{11} \vert \psi_1 \vert^2 + g_{12} \vert \psi_2 \vert^2 - i \hbar \Gamma_1
\right) \psi_1 + \frac{\hbar \Omega}{2}e^{i \omega t} \psi_2, \]
\[ i \hbar \frac{\partial \psi_2}{\partial t} = \left(
	-\frac{\hbar^2\nabla^2}{2m} + V_2(\mathbf{r}) + 
	g_{12} \vert \psi_1 \vert^2 + g_{22} \vert \psi_2 \vert^2 - i \hbar \Gamma_2
\right) \psi_2 + \frac{\hbar \Omega}{2}e^{i \omega t} \psi_1 - \hbar \Delta \psi_2. \]
Here $V_1$ and $V_2$ stand for the external potential (which, in general, is different for each component), $g_{11}$, $g_{12}$ and $g_{22}$ are interaction coefficients, $\Gamma_1$ and $\Gamma_2$ are responsible for two- and three-body loss processes correspondingly, $\Omega$ is a constant for state transitions due to external oscillating magnetic field, and $\Delta$ is a detuning frequency.

\bibliographystyle{plain}
\bibliography{refs}

\end{document}