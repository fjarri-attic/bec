\documentclass[12pt,notitlepage]{report}
\usepackage{indentfirst}
\usepackage[pdftex]{graphicx}
\usepackage{subfig}

\title{Two-component BEC dynamics calculations using split-step Fourier method}
\author{Bogdan Opanchuk}

\begin{document}
\maketitle

\section*{Thomas-Fermi approximation}

We are looking for steady state of the system with pseudopotential model hamiltonian:
\[ 
\hat{H} = -\frac{\hbar^2}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} + \\
V(\mathbf{r}) + \\
g_{11} \vert \psi(\mathbf{r}) \vert^2 
\]
\[g_{11} = \frac{4 \pi \hbar^2 a_{11}}{m}\]
\[ V(\mathbf{r}) = \frac{m}{2} \left( \omega_x^2 x^2 + \omega_y^2 y^2 + \omega_z^2 z^2 \right) \]
where $V(\mathbf{r})$ is the potential energy for parabolic trap, $g_{11}$ is the interaction coefficient
and $a_{11}$ is the scattering length for atoms in non-excited state.

The steady state should satisfy the Gross-Pitaevskii equation:
\[ \hat{H} \psi = \mu \psi \]
To get the first approximation of the state function, we consider the kinetic term to be small as compared to other terms and omit it. The conditions for this operation to be valid will be determined later in this section. Thus we get the simple equation:
\[ \left( V(\mathbf{r}) + g_{11} \vert \psi(\mathbf{r}) \vert^2 \right) \psi(\mathbf{r}) = \mu \psi(\mathbf{r}) \]
which leads us to the state function:
\[ \vert \psi(\mathbf{r}) \vert^2 = \frac{1}{g_{11}} \max \left( \mu - V(\mathbf{r}), 0 \right) \]
The condition for $V(\mathbf{r})$ defines the shape of the condensate - it is the ellipsoid with the following radii:
\[ r_i = \sqrt{\frac{2 \mu}{m \omega_i^2}}, i = x, y, z \]

Using the normalisation condition for the steady state function gives us the connection between the number of atoms in the condensate and the chemical potential:
\[ \int\limits_{V} \vert \psi(\mathbf{r}) \vert^2 dV = N \]
\[ 
\mu = \left( \frac{15 N}{8 \pi} \right)^\frac{2}{5} \\
\left( \frac{m \bar{\omega}^2}{2} \right)^\frac{3}{5} \\
{g_{11}}^\frac{2}{5}
\]
where $\bar{\omega} = \sqrt[3]{\omega_x \omega_y \omega_z}$.

Now we can estimate the conditions necessary to drop the kinetic term from equation. We will do it for one-dimensional case for the sake of simplicity; three-dimensional results will differ only in coefficients of the order of unity:
\[ 
\frac{\hbar^2}{2 m} \vert \frac{d^2 \psi}{d x^2} \vert \ll \\
\left( V + g_{11} \vert \psi \vert^2 \right) \vert \psi \vert
\]
Substituting the expression for $\psi$ and simplifying the inequation:
\[
\frac{\hbar^2}{2 m} \left( \mu + \frac{V}{2} \right) \ll \\
x^2 \left( \mu - V \right)^2 + \frac{2}{m \omega^2} \left( \mu - V \right)^3
\]

Simple (but lengthy) calculation of the first order derivative shows that we need to investigate only cases of $x=0$ and
$x=r_x$. For $x=0$ the condition straightforwardly turns into $\mu \gg \frac{\hbar \omega}{2}$, or just
$\mu \gg \hbar \omega$, since the coefficient of the order of unity is insignificant.
On the other hand, for $x=r_x$ the inequation turns into $\mu \ll 0$ which is apparently always false. This means that
near the edges of the condensate Thomas-Fermi approximation will fail. Fortunately, the density of the particles
there is low, so we can estimate the width $h$ of the "belt" where our first approximation of the state function is
sufficiently incorrect. After replacing $x$ by $r_x - h$ and "$\ll$" by "$\approx$" in inequation, we will get (providing that 
$h \ll r_x$) $h \approx \sqrt{\frac{3 \hbar^2}{m \mu}}$. So, in order the belt to be narrow --- or, in other words
$h \ll r_x$ --- the chemical potential should satisfy the similarly looking condition as for the case of $x=0$: 
$\mu \gg \sqrt{\frac{3}{2}} \hbar \omega$ or just $\mu \gg \hbar \omega$. For three-dimensional case we can safely substitute $\bar{\omega}$ for $\omega$ in the condition.

Let us use some real-life experimental parameters and check how well Thomas-Fermi approximation works.
For three-dimensional trap with frequencies $f_x = f_y = 97.6 \textrm{ Hz}$ and $f_x = 11.96 \textrm{ Hz}$ and
$10^5$ rubidium atoms (which have scattering length $a_{11} = 100.4 a_0$, where $a_0$ is Bohr radius):
\[ \frac{\mu}{\hbar \bar{\omega}} \approx 15.3 \]
This is a pretty good result, which means that Thomas-Fermi approximation produces state close to the real one.
But for lower amount of atoms, say $10^4$, we get:
\[ \frac{\mu}{\hbar \bar{\omega}} \approx 6 \]
which is lower than the order of ten. Therefore, for low amounts of atoms, Thomas-Fermi approximation should be
used with care. 

\section*{Steady state calculation}

The steady state obtained using Thomas-Fermi approximation is good for estimation purposes, but not for
real-life calculations - for example, it does not have continuous first derivative everywhere (namely,
near the edges of the condensate). That is why we have to employ numerical calculations in order
to find precise (to a certain extent) solution of the Gross-Pitevskii equation. One of the possible methods, 
namely combination of split-step Fourier method and imaginary time, will be described in this section.

The idea of the imaginary time method is that propagating the system state using the time-dependent GPE
but with substitution $t \rightarrow \tau = -it$ diminishes energy of the system, so after the sufficient
amount of time this propagation will lead us to steady state. The rigorous proof of this method can be found in
\cite{gpe_ngf}, but there is a simple "hand-waving" explanation.

Let us say we have the system with Hamiltonian $\hat{H}$, whose eigenvalues are $\mu_1 < \mu_2 < ...$.
They do not have to correspond to real states of BEC, we just know that this Hamiltonian must have discrete
spectre (because of the form of the potential) and the lowest eigenvalue corresponds to steady state we want
to find. The steady solution of time-dependent GPE
\[ i \hbar \frac{\partial \psi}{\partial t} = \hat{H} \psi \]
then looks like
\[ \psi(\mathbf{r}, t) = \sum_k e^{-\frac{i}{h} \mu_k t} f_k(\mathbf{r}) \]
We can use Hamiltonian to propagate the solution in time:
\[ 
\psi(t + dt) \simeq \psi(t) + \frac{\partial \psi}{\partial t} dt = \\
\psi(t) + \frac{dt}{i \hbar} \hat{H} \psi(t)
\]

Now consider the substitution $t \rightarrow \tau = it$; after it the steady solution will become fading, with
higher-energy components fading faster:
\begin{equation}
\label{split_step_steady_state:general_solution_imaginary_time}
\psi(\mathbf{r}, \tau) = \sum_k e^{-\frac{1}{h} \mu_k \tau} f_k(\mathbf{r})
\end{equation}
Therefore, if we take some random initial solution and propagate it for a sufficient amount of time, higher-energy
components will eventually die out (in comparison with the lowest-energy state) and leave us with desired 
steady state:
\begin{equation}
\label{split_step_steady_state:iterative_process}
\psi(\tau + d\tau) \simeq \psi(\tau) - \frac{d\tau}{\hbar} \hat{H} \psi(\tau)
\end{equation}
The state obtained from Thomas-Fermi approximated GPE can be taken as an initial one, since it is rather close
to the desired one (and, therefore, higher-energy components are already quite small).

The above explanation of imaginary-time method assumes the superposition principle works for GPE, but it does not
because of the nonlinearity. Therefore this explanation can serve just for illustrative purposes and estimations.
For example, we can find the rough criterion for convergence of the process by substituting general solution
\ref{split_step_steady_state:general_solution_imaginary_time} into equation
\ref{split_step_steady_state:iterative_process}:
\[ \psi(\tau + d\tau) \simeq \sum_k e^{-\frac{1}{h} \mu_k \tau} f_k(\mathbf{r}) \left( 1 - d\tau \frac{\mu_k}{\hbar} \right) \]
which immediately gives us the condition:
\[ d\tau < \frac{\hbar}{\mu_1} \]
because the chemical potential of the steady state is the largest one.

Since the energy will decrease exponentially after each step and the precision of numerical calculations is limited,
renormalisation after each step will be required. Known total number of atoms in steady
state serves best in this case (because we will have to renormalise the final steady state anyway):
\[ \int\limits_V \vert \psi(\tau, \mathbf{r}) \vert^2 dV = N \]

Propagation should be terminated when the total energy of the state stops changing (that is, only one component
with the lowest energy is left out). So, we need to calculate the total energy after each step:
\[ E(\psi) = \int\limits_V \psi^\dagger \left( \\
-\frac{\hbar^2}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} + V(\mathbf{r}) + \\
\frac{g_{11}}{2} \vert \psi(\mathbf{r}) \vert^2 \right) \psi dV \]
and compare it to the previous value.

Now how do we propagate the state of the system? There are a lot of possibilities, one of which is split-step
Fourier method. It is rather simple and can be effectively parallelised, which means a good scaling and 
low computation times. 

The propagation in imaginary time can be described as:
\[ \psi(\tau + d\tau, \mathbf{r}) \simeq \exp \left( -\frac{d\tau}{\hbar} \hat{H} \right) \psi(\tau, \mathbf{r}) \]
The idea of split-step Fourier method is to separate the execution of different parts of Hamiltonian:
\begin{equation}
\label{split_step_steady_state:splitted_propagation}
\psi(\tau + d\tau, \mathbf{r}) \simeq \exp(d\tau \hat{D}) \exp(d\tau \hat{N}) \psi(\tau, \mathbf{r})
\end{equation}
where $\hat{D}$ and $\hat{N}$ are chosen so that they could be executed most conveniently in Fourier and spatial
domains correspondingly. For our Hamiltonian
\[ 
\hat{H} = -\frac{\hbar^2}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} + \\
V(\mathbf{r}) + g_{11} \vert \psi(\mathbf{r}) \vert^2 
\]
it means that
\[ \hat{D} = \frac{\hbar}{2m} \frac{\partial^2}{\partial \mathbf{r}^2} \]
\[ \hat{N} = -\frac{1}{\hbar} \left( V(\mathbf{r}) + g_{11} \vert \psi(\mathbf{r}) \vert^2 \right) \] 
The spatial derivative is a simple multiplication in Fourier domain, so the propagation can be performed 
straightforwardly:
\[ 
\psi(\tau + d\tau, \mathbf{r}) \simeq \left\{ \hat{F}^{-1} \exp \left[ d\tau \hat{D}(i\omega) \right] \hat{F} \right\} \\
\exp(d\tau \hat{N}) \psi(\tau, \mathbf{r})
\]
Here $\hat{D}(i\omega)$ is obtained by replacing differential operator by $i \omega$, where $\omega$ is a
frequency in Fourier domain.

In order to improve the accuracy of the method, equation \ref{split_step_steady_state:splitted_propagation}
can be rewritten as
\[
\psi(\tau + d\tau, \mathbf{r}) \simeq \exp \left( \frac{d\tau}{2} \hat{D} \right) \\
\exp \left( \int\limits^{\tau + d\tau}_\tau \hat{N} (\tau^\prime) d\tau^\prime \right) \\
\exp \left( \frac{d\tau}{2} \hat{D} \right) \psi(\tau, \mathbf{r})
\]
This method is called the symmetrized split-step Fourier method. Integral can be evaluated either by approximating it
with $d\tau\hat{N}$ or by using more accurate method, like trapezoidal rule
\[
\int\limits^{\tau + d\tau}_\tau \hat{N} (\tau^\prime) d\tau^\prime \simeq \\
\frac{d\tau}{2} \left( \hat{N}(\tau) + \hat{N}(\tau + d\tau) \right)
\]
Since the value of $\hat{N}(\tau + d\tau)$ is unknown at the time of the calculation (it is performed in the
middle of the step), an iterative procedure is necessary.

\bibliographystyle{plain}
\bibliography{refs}

\end{document}